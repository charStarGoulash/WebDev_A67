<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>WDD Assignment #7</title>

    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var uri = 'api/textfile';

        function populateDropdown() {
            $.getJSON(uri)
                .done(function (data) {
                    var $dropdown = $("#files");
                    $dropdown.empty();
                    $.each(data, function () {
                        $dropdown.append($("<option />").val(this.fileID).text(this.fileName));
                    });
                });
        }

        $(document).ready(function () {
            $("#loadButton").click(find);
            $("#saveButton").click(saveFile);            
            // Send an AJAX request
            populateDropdown();
        });

        function formatItem(item) {
            return item.fileID + ". " + item.fileName;
        }

        function find() {
            var id = $('#files').val();
            $.getJSON(uri + '/' + id)
                .done(function (data) {
                    $("#saveFileName").val(data.fileName);
                    $("#text").text(data.fileContent);
                })
                .fail(function (jqXHR, textStatus, err) {
                });
        }

        function saveFile() {
            $("#messageWindow").text("Saving File...");
            $.post(uri + "/SaveFile",
                {
                    dataType: 'json',
                    contentType: "application/json",
                    fileName: $("#saveFileName").val(),
                    fileContent: $("#text").val()
                },
                function (status) {
                    populateDropdown();
                    alert("Status: " + status);
                });
        };

        function find() {
            var id = $('#files').val();
            $("#saveFileName").val(id);
            $.getJSON(uri + '/' + id)
                .done(function (data) {
                    $("#saveFileName").val(data.fileName);
                    $("#text").val(data.fileContent);
                })
                .fail(function (jqXHR, textStatus, err) {
                    $('#saveFileName').val('Error: ' + err);
                });
        }

        function ajaxCallComplete(responseTxt, statusTxt, xhr) {
            if (statusTxt == "success") {
                alert("External content loaded successfully!");
            }
            if (statusTxt == "error") {
                alert("Error: " + xhr.status + ": " + xhr.statusText);
            }
        }
    </script>
    <link rel="stylesheet" type="text/css" href="Styles/style.css">
</head>
<body>
    <div class="fullTopDiv">
        <div class="titleDiv">
            <h1>WDD: A7 - Text Editor in JQuery/AJAX</h1>
        </div>
        <div class="editOptions">
            <select class="selectBox" id="files"></select>
            <input class="button allButton" type="button" id="loadButton" value="Load File" />
            <input class="button allButton" type="button" id="saveButton" value="Save File" />
            <input class="textBox" type="text" id="saveFileName" value="" />
        </div>
    </div>
    <div>
        <textarea id="text" class="editWindow"></textarea>
    </div>
</body>
</html>